# Codebase Structure

**Analysis Date:** 2026-01-18

## Directory Layout

```
makermaker/
├── app/                    # Application source (PSR-4: MakerMaker\)
│   ├── Auth/              # Authorization policies
│   ├── Controllers/       # HTTP controllers
│   │   ├── Api/V1/       # REST API controllers
│   │   └── Web/          # Admin form controllers
│   ├── Http/             # HTTP utilities
│   │   └── Fields/       # Field validation classes
│   ├── Models/           # Data models
│   ├── MakermakerTypeRocketPlugin.php
│   └── View.php
├── config/                 # TypeRocket configuration
├── database/
│   └── migrations/        # Schema migrations (DATA TRUTH)
├── galaxy/                 # Galaxy CLI scaffolding
├── inc/
│   ├── resources/         # Dynamic resource registration
│   └── routes/            # Route definitions
├── public/                 # Compiled assets (output)
├── resources/              # Source assets
│   ├── js/
│   ├── sass/
│   └── views/
├── tests/                  # Pest test files
├── .claude/                # Claude Code agents/skills
├── .planning/              # Project documentation
├── makermaker.php          # Plugin entry point
└── uninstall.php           # Uninstall handler
```

## Directory Purposes

**app/**
- Purpose: Application source code
- Contains: PHP classes with PSR-4 autoloading
- Key files: `MakermakerTypeRocketPlugin.php` (main plugin class)
- Subdirectories: `Auth/`, `Controllers/`, `Http/`, `Models/`

**config/**
- Purpose: TypeRocket framework configuration
- Contains: PHP config files returning arrays
- Key files: `app.php`, `database.php`, `paths.php`, `mail.php`
- Pattern: `config/{feature}.php`

**database/migrations/**
- Purpose: Schema definitions (source of truth for data structure)
- Contains: Migration PHP files
- Pattern: `{YYYY}_{MM}_{DD}_{action}_{table}.php`
- Run via: `php galaxy migrate`

**inc/routes/**
- Purpose: HTTP route definitions
- Contains: `api.php` (REST), `public.php` (web)
- Loaded by: `MakermakerTypeRocketPlugin::routes()`

**inc/resources/**
- Purpose: Dynamic resource registration files
- Contains: PHP files auto-loaded on init
- Pattern: `{ResourceName}.php` with `mm_create_custom_resource()`

**public/**
- Purpose: Compiled assets (build output)
- Contains: `admin/`, `front/` with CSS/JS
- Generated by: `npm run prod`
- Manifest: `mix-manifest.json`

**resources/**
- Purpose: Source assets for compilation
- Contains: `js/`, `sass/`, `views/`
- Compiled to: `public/`

**tests/**
- Purpose: Pest framework tests
- Contains: `Unit/`, `Integration/`, `Feature/`, `Acceptance/`
- Config: `Pest.php`, `bootstrap.php`

**.claude/**
- Purpose: Claude Code agent configurations
- Contains: `agents/`, `skills/`
- Usage: MVC resource scaffolding via specialized agents

## Key File Locations

**Entry Points:**
- `makermaker.php` - WordPress plugin header, hooks `typerocket_loaded`
- `app/MakermakerTypeRocketPlugin.php` - Plugin initialization class
- `uninstall.php` - Clean uninstall handler

**Configuration:**
- `config/app.php` - Extensions, services, debug settings
- `config/database.php` - Database driver configuration
- `config/paths.php` - Path constants (storage, cache, logs)
- `composer.json` - PHP dependencies, PSR-4 autoload
- `webpack.mix.js` - Asset build configuration

**Core Logic:**
- `app/Controllers/Api/V1/*.php` - REST endpoint handlers
- `app/Controllers/Web/*.php` - Admin form handlers
- `app/Models/*.php` - Data models with relationships
- `app/Auth/*Policy.php` - Authorization policies

**Testing:**
- `tests/Unit/` - Unit tests
- `tests/Feature/` - Feature tests
- `tests/Pest.php` - Pest config, Brain Monkey setup
- `phpunit.xml` - PHPUnit/Pest configuration

**Documentation:**
- `CLAUDE.md` - Claude Code guidance
- `.planning/codebase/` - Architecture documentation

## Naming Conventions

**Files:**
- PascalCase.php: Classes (`MakermakerTypeRocketPlugin.php`, `Service.php`)
- kebab-case.php: Config files (`app.php`, `database.php`)
- *Test.php: Test files (`BasicUnitTest.php`)
- *Policy.php: Authorization policies (`ServicePolicy.php`)
- *Controller.php: Controllers (`ServiceController.php`)

**Directories:**
- PascalCase: Namespace segments (`Controllers/`, `Models/`)
- kebab-case: Non-code directories (`resources/`, `public/`)
- lowercase: Standard directories (`config/`, `tests/`)

**Special Patterns:**
- `*Policy.php` → Auto-discovered for authorization
- `inc/resources/*.php` → Auto-loaded on init
- `database/migrations/*.php` → Run by migrate command

## Where to Add New Code

**New Model:**
- Primary: `app/Models/{ModelName}.php`
- Migration: `database/migrations/{date}_create_{table}_table.php`
- Tests: `tests/Unit/Models/{ModelName}Test.php`

**New Controller:**
- REST: `app/Controllers/Api/V1/{Resource}Controller.php`
- Web: `app/Controllers/Web/{Resource}Controller.php`
- Tests: `tests/Feature/Controllers/{Resource}ControllerTest.php`

**New Policy:**
- Implementation: `app/Auth/{Model}Policy.php`
- Auto-discovered: Naming convention `{Model}Policy` required
- Tests: `tests/Unit/Auth/{Model}PolicyTest.php`

**New Route/Endpoint:**
- REST routes: `inc/routes/api.php`
- Web routes: `inc/routes/public.php`
- Or: Use `mm_create_custom_resource()` in `inc/resources/`

**New Validation Fields:**
- Implementation: `app/Http/Fields/{Resource}Fields.php`
- Pattern: Extend TypeRocket Fields class

**Utilities:**
- Shared helpers: `app/Utilities/` (create if needed)
- Type definitions: Within class files (PHP 8.2+ typed)

## Special Directories

**vendor/**
- Purpose: Composer dependencies
- Source: Auto-generated by `composer install`
- Committed: No (in `.gitignore`)

**public/**
- Purpose: Compiled assets
- Source: Generated by Laravel Mix
- Committed: Yes (for deployment without build step)

**node_modules/**
- Purpose: npm dependencies
- Source: Auto-generated by `npm install`
- Committed: No (in `.gitignore`)

**.planning/**
- Purpose: Project documentation and planning
- Committed: Yes (project context)

---

*Structure analysis: 2026-01-18*
*Update when directory structure changes*
